<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GSW - Tag der offenen Tür</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
        }

        h1 {
            color: #333;
        }

        canvas {
            display: block;
            margin: 20px auto;
            border: 2px solid #333;
            background-color: #87CEEB;
        }

        #score, #timer {
            font-size: 24px;
            margin-top: 10px;
        }

        #gameOver {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            font-size: 32px;
        }
    </style>
</head>
<body>
    <h1>Rennspiel</h1>
    <canvas id="gameCanvas"></canvas>
    <div id="score">Score: 0</div>
    <div id="timer">Zeit: 60s</div>
    <div id="gameOver">Game Over! Dein Score: <span id="finalScore"></span></div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const timerDisplay = document.getElementById('timer');
        const gameOverScreen = document.getElementById('gameOver');
        const finalScoreDisplay = document.getElementById('finalScore');
        
        canvas.width = 800;
        canvas.height = 400;

        let score = 0;
        let timeLeft = 60; // 60 Sekunden Timer
        let gameRunning = true;

        let car = {
            x: canvas.width / 2 - 25,
            y: canvas.height - 80,
            width: 50,
            height: 30,
            lane: 1,
            speed: 5,
        };

        let road = {
            width: 200,
            height: canvas.height,
            x: (canvas.width / 2) - 100,
            lanes: 3,
            laneWidth: 200 / 3,
        };

        let coins = [];
        let terrain = [];

        function createCoin() {
            let lane = Math.floor(Math.random() * road.lanes);
            coins.push({
                x: road.x + lane * road.laneWidth + road.laneWidth / 2 - 10,
                y: 0,
                width: 20,
                height: 20,
                collected: false
            });
        }

        function createTerrain() {
            let lane = Math.floor(Math.random() * road.lanes);
            terrain.push({
                x: road.x + lane * road.laneWidth + road.laneWidth / 2 - 30,
                y: 0,
                width: 60,
                height: 60,
                type: Math.random() > 0.5 ? 'tree' : 'bush'
            });
        }

        function drawCar() {
            ctx.fillStyle = 'red';
            car.x = road.x + car.lane * road.laneWidth + road.laneWidth / 2 - car.width / 2;
            ctx.fillRect(car.x, car.y, car.width, car.height);
        }

        function drawRoad() {
            ctx.fillStyle = 'gray';
            ctx.fillRect(road.x, 0, road.width, road.height);
            ctx.strokeStyle = 'white';
            ctx.setLineDash([20, 15]);
            ctx.lineWidth = 5;
            ctx.beginPath();
            for (let i = 1; i < road.lanes; i++) {
                ctx.moveTo(road.x + i * road.laneWidth, 0);
                ctx.lineTo(road.x + i * road.laneWidth, road.height);
            }
            ctx.stroke();
        }

        function drawCoins() {
            ctx.fillStyle = 'gold';
            coins.forEach(coin => {
                if (!coin.collected) {
                    ctx.beginPath();
                    ctx.arc(coin.x + coin.width / 2, coin.y + coin.height / 2, 10, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
        }

        function drawTerrain() {
            terrain.forEach(item => {
                if (item.type === 'tree') {
                    ctx.fillStyle = 'green';
                    ctx.fillRect(item.x, item.y, item.width, item.height);
                } else {
                    ctx.fillStyle = 'darkgreen';
                    ctx.fillRect(item.x, item.y, item.width, item.height / 2);
                }
            });
        }

        function updateCoins() {
            coins.forEach(coin => {
                coin.y += car.speed;
                if (coin.y > canvas.height) {
                    coins.splice(coins.indexOf(coin), 1);
                }
                if (!coin.collected &&
                    coin.x < car.x + car.width &&
                    coin.x + coin.width > car.x &&
                    coin.y < car.y + car.height &&
                    coin.y + coin.height > car.y) {
                    coin.collected = true;
                    score += 10;
                    scoreDisplay.innerText = `Score: ${score}`;
                }
            });
        }

        function updateTerrain() {
            terrain.forEach(item => {
                item.y += car.speed;
                if (item.y > canvas.height) {
                    terrain.splice(terrain.indexOf(item), 1);
                }
                // Überprüfung auf Kollision mit Terrain
                if (item.x < car.x + car.width &&
                    item.x + item.width > car.x &&
                    item.y < car.y + car.height &&
                    item.y + item.height > car.y) {
                    gameOver();
                }
            });
        }

        function updateGame() {
            if (!gameRunning) return;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawRoad();
            drawCar();
            drawCoins();
            drawTerrain();
            updateCoins();
            updateTerrain();

            // Zufälliges Erzeugen von Münzen und Terrain mit Mindestabstand
            if (coins.length === 0 || coins[coins.length - 1].y > 50) {
                if (Math.random() < 0.02) createCoin();
            }
            if (terrain.length === 0 || terrain[terrain.length - 1].y > 50) {
                if (Math.random() < 0.01) createTerrain();
            }

            requestAnimationFrame(updateGame);
        }

        document.addEventListener('keydown', (event) => {
            if (event.key === 'ArrowLeft' && car.lane > 0) {
                car.lane--;
            }
            if (event.key === 'ArrowRight' && car.lane < road.lanes - 1) {
                car.lane++;
            }
        });

        function startTimer() {
            const timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    timerDisplay.innerText = `Zeit: ${timeLeft}s`;
                } else {
                    clearInterval(timerInterval);
                    gameOver();
                }
            }, 1000);
        }

        function gameOver() {
            gameRunning = false;
            finalScoreDisplay.innerText = score;
            gameOverScreen.style.display = 'block';
        }

        startTimer();
        updateGame();
    </script>
</body>
</html>
